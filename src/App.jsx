import { useState } from "react";
import axios from "axios";
import { useNavigate, Link } from "react-router-dom";

function App() {
  const navigate = useNavigate();

  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [message, setMessage] = useState("");
  const [loading, setLoading] = useState(false);

  const BACKEND_URL = "https://nn-pms-officers-2dd5ac29e658.herokuapp.com";

  const handleLogin = async (e) => {
    e.preventDefault();
    setMessage("");
    setLoading(true);

    try {
      const res = await axios.post(
        `${BACKEND_URL}/auth/login`,
        { email, password },
        { headers: { "Content-Type": "application/json" } } // ensure JSON is sent
      );

      console.log("Login response:", res.data); // <-- debug response

      setLoading(false);

      if (res.data && res.data.token && res.data.user) {
        localStorage.setItem("token", res.data.token);
        localStorage.setItem("user", JSON.stringify(res.data.user));
        setMessage("Login successful!");
        navigate("/dashboard");
      } else {
        setMessage(
          res.data.message || "Login failed. Please check credentials."
        );
      }
    } catch (err) {
      setLoading(false);
      console.error("Login error:", err);

      if (err.response && err.response.data && err.response.data.message) {
        setMessage(err.response.data.message);
      } else if (err.request) {
        setMessage("No response from server. Check your backend.");
      } else {
        setMessage("Something went wrong. Try again.");
      }
    }
  };

  return (
    <div className="flex h-auto min-h-screen items-center justify-center overflow-x-hidden bg-[url('img/illustrations/auth-background-2.png')] bg-cover bg-center bg-no-repeat py-10">
      <div className="relative flex items-center justify-center px-4 sm:px-6 lg:px-8">
        {/* SVG background */}
        <div className="absolute">
          <svg
            width={612}
            height={697}
            viewBox="0 0 612 697"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M97.4387 622.042C96.3793 621.236 95.3369 620.415 94.3115 619.58L93.9959 619.968C91.9211 618.28 89.9158 616.536 87.9805 614.74L88.3206 614.374C86.3673 612.562 84.4856 610.697 82.6761 608.783L82.3128 609.127C80.4764 607.185 78.7139 605.193 77.026 603.154L77.4111 602.836C75.7156 600.788 74.0956 598.694 72.5516 596.557L72.1463 596.85C70.5835 594.687 69.0983 592.481 67.6913 590.235L68.1149 589.97C66.7047 587.719 65.3733 585.429 64.1214 583.104L63.6812 583.341C62.4181 580.995 61.2356 578.613 60.1343 576.2L60.5891 575.992C59.4876 573.579 58.4677 571.134 57.5299 568.663L57.0624 568.84C56.1179 566.351 55.2564 563.834 54.4784 561.295L54.9565 561.149C54.1802 558.615 53.4874 556.058 52.8788 553.483L52.3922 553.598C51.7803 551.01 51.2531 548.403 50.8112 545.782L51.3042 545.698C50.864 543.087 50.5087 540.462 50.2391 537.828L49.7417 537.879C49.4712 535.235 49.2865 532.581 49.1884 529.923L49.688 529.904C49.5905 527.26 49.5788 524.612 49.6538 521.963L49.154 521.949C49.2291 519.294 49.3908 516.639 49.6397 513.988L50.1375 514.035C50.3847 511.403 50.7182 508.775 51.1386 506.156L50.6449 506.076C51.0653 503.457 51.5723 500.847 52.1664 498.25L52.6538 498.361C53.2426 495.787 53.9175 493.225 54.6788 490.681L54.1998 490.537C54.9594 487.999 55.8049 485.477 56.7366 482.977L57.2052 483.151C58.1257 480.681 59.1309 478.232 60.2213 475.807L59.7653 475.602C60.8508 473.188 62.0203 470.799 63.2746 468.439L63.7161 468.674C64.9519 466.348 66.2703 464.05 67.6717 461.784L67.2465 461.521C68.635 459.276 70.1047 457.062 71.6561 454.883L72.0634 455.173C72.8302 454.096 73.6169 453.027 74.4238 451.968L76.8308 448.808L76.4331 448.505L81.2471 442.184L81.6449 442.487L86.4589 436.166L86.0611 435.863L90.8752 429.542L91.273 429.845L96.087 423.524L95.6892 423.221L100.503 416.9L100.901 417.203L105.715 410.882L105.317 410.58L110.131 404.259L110.529 404.562L115.343 398.241L114.945 397.938L119.759 391.617L120.157 391.92L124.971 385.599L124.574 385.296L129.388 378.975L129.785 379.278L134.599 372.957L134.202 372.654L139.016 366.334L139.413 366.637L144.227 360.316L143.83 360.013L148.644 353.692L149.042 353.995L153.856 347.674L153.458 347.371L158.272 341.05L158.67 341.353L163.484 335.032L163.086 334.729L167.9 328.409L168.298 328.711L173.112 322.391L172.714 322.088L177.528 315.767L177.926 316.07L182.74 309.749L182.342 309.446L187.156 303.125L187.554 303.428L192.368 297.107L191.97 296.804L196.784 290.483L197.182 290.786L201.996 284.465L201.598 284.163L206.412 277.842L206.81 278.145L211.624 271.824L211.226 271.521L216.04 265.2L216.438 265.503L221.252 259.182L220.854 258.879L225.669 252.558L226.066 252.861L230.88 246.54L230.483 246.237L235.297 239.917L235.694 240.22L240.508 233.899L240.111 233.596L244.925 227.275L245.322 227.578L250.136 221.257L249.739 220.954L254.553 214.633L254.951 214.936L259.765 208.615L259.367 208.312L264.181 201.992L264.579 202.294L269.393 195.974L268.995 195.671L273.809 189.35L274.207 189.653L279.021 183.332L278.623 183.029L283.437 176.708L283.835 177.011L288.649 170.69L288.251 170.387L293.065 164.067L293.463 164.369L298.277 158.049L297.879 157.746L302.693 151.425L303.091 151.728L307.905 145.407L307.507 145.104L312.321 138.783L312.719 139.086L317.533 132.765L317.135 132.462L321.949 126.141L322.347 126.444L327.161 120.124L326.763 119.821L331.577 113.5L331.975 113.803L336.789 107.482L336.391 107.179L341.205 100.858L341.603 101.161L344.01 98.0005C344.817 96.9411 345.638 95.8986 346.473 94.8733L346.085 94.5577C347.773 92.4829 349.517 90.4776 351.312 88.5423L351.679 88.8823C353.491 86.929 355.356 85.0474 357.269 83.2379L356.926 82.8746C358.868 81.0382 360.86 79.2757 362.898 77.5878L363.217 77.9729C365.265 76.2773 367.359 74.6573 369.496 73.1134L369.203 72.7081C371.366 71.1452 373.572 69.66 375.817 68.253L376.083 68.6767C378.333 67.2665 380.624 65.9351 382.949 64.6832L382.712 64.243C385.058 62.9799 387.44 61.7974 389.853 60.696L390.061 61.1509C392.474 60.0494 394.919 59.0295 397.39 58.0917L397.213 57.6242C399.702 56.6797 402.219 55.8182 404.758 55.0402L404.904 55.5183C407.438 54.742 409.995 54.0493 412.569 53.4406L412.454 52.954C415.043 52.3421 417.65 51.8149 420.271 51.373L420.354 51.866C422.966 51.4258 425.591 51.0705 428.225 50.8009L428.174 50.3035C430.818 50.033 433.472 49.8483 436.13 49.7502L436.149 50.2498C438.792 50.1523 441.441 50.1406 444.09 50.2156L444.104 49.7158C446.759 49.7909 449.414 49.9526 452.065 50.2015L452.018 50.6993C454.65 50.9465 457.278 51.28 459.897 51.7004L459.976 51.2068C462.595 51.6272 465.206 52.1341 467.803 52.7282L467.692 53.2156C470.266 53.8045 472.828 54.4793 475.372 55.2407L475.516 54.7617C478.054 55.5213 480.576 56.3667 483.076 57.2985L482.902 57.767C485.372 58.6875 487.821 59.6927 490.246 60.7831L490.451 60.3271C492.864 61.4126 495.253 62.5822 497.614 63.8364L497.379 64.2779C499.705 65.5138 502.003 66.8321 504.269 68.2336L504.532 67.8083C506.777 69.1968 508.991 70.6665 511.17 72.218L510.88 72.6253C511.957 73.392 513.025 74.1788 514.085 74.9856C515.144 75.7925 516.187 76.6134 517.212 77.4478L517.528 77.06C519.602 78.7485 521.608 80.4923 523.543 82.2877L523.203 82.6542C525.156 84.4663 527.038 86.331 528.847 88.2446L529.211 87.9011C531.047 89.8432 532.81 91.8354 534.498 93.8737L534.112 94.1926C535.808 96.2401 537.428 98.3342 538.972 100.471L539.377 100.178C540.94 102.341 542.425 104.547 543.832 106.793L543.409 107.058C544.819 109.309 546.15 111.599 547.402 113.924L547.842 113.687C549.105 116.033 550.288 118.415 551.389 120.828L550.934 121.036C552.036 123.449 553.056 125.894 553.994 128.366L554.461 128.188C555.406 130.677 556.267 133.194 557.045 135.733L556.567 135.88C557.343 138.413 558.036 140.97 558.645 143.545L559.131 143.43C559.743 146.018 560.27 148.626 560.712 151.247L560.219 151.33C560.66 153.941 561.015 156.566 561.284 159.2L561.782 159.149C562.052 161.794 562.237 164.447 562.335 167.105L561.836 167.124C561.933 169.768 561.945 172.416 561.87 175.065L562.37 175.08C562.294 177.734 562.133 180.389 561.884 183.04L561.386 182.993C561.139 185.625 560.805 188.253 560.385 190.872L560.879 190.952C560.458 193.571 559.951 196.181 559.357 198.778L558.87 198.667C558.281 201.241 557.606 203.803 556.845 206.347L557.324 206.491C556.564 209.029 555.719 211.551 554.787 214.052L554.318 213.877C553.398 216.347 552.393 218.797 551.302 221.221L551.758 221.426C550.673 223.84 549.503 226.229 548.249 228.589L547.807 228.354C546.572 230.68 545.253 232.978 543.852 235.244L544.277 235.507C542.889 237.752 541.419 239.966 539.867 242.145L539.46 241.855C538.693 242.932 537.907 244.001 537.1 245.06L534.693 248.221L535.09 248.523L530.276 254.844L529.879 254.541L525.065 260.862L525.463 261.165L520.649 267.486L520.251 267.183L515.437 273.504L515.835 273.807L511.021 280.128L510.623 279.825L505.809 286.146L506.207 286.449L501.393 292.77L500.995 292.467L496.181 298.788L496.579 299.091L491.765 305.412L491.367 305.109L486.553 311.43L486.951 311.733L482.137 318.054L481.739 317.751L476.925 324.072L477.323 324.375L472.509 330.696L472.111 330.393L467.297 336.714L467.695 337.017L462.881 343.338L462.483 343.035L457.669 349.356L458.067 349.659L453.253 355.98L452.855 355.677L448.041 361.998L448.439 362.301L443.625 368.622L443.227 368.319L438.413 374.64L438.811 374.943L434.997 381.264L434.599 380.961L429.785 387.282L430.183 387.585L425.369 393.906L424.971 393.603L420.157 399.924L420.555 400.227L415.741 406.548L415.343 406.245L410.529 412.566L410.927 412.869L406.113 419.19L405.715 418.887L400.901 425.208L401.299 425.511L396.485 431.832L396.087 431.529L391.273 437.85L391.671 438.153L386.857 444.474L386.459 444.171L381.645 450.492L382.043 450.795L377.229 457.116L376.831 456.813L372.017 463.134L372.415 463.437L367.601 469.758L367.203 469.455L362.389 475.776L362.787 476.079L358.973 482.4L358.575 482.097L353.761 488.418L354.159 488.721L349.345 495.042L348.947 494.739L344.133 501.06L344.531 501.363L339.717 507.684L339.319 507.381L334.505 513.702L334.903 514.005L330.089 520.326L329.691 520.023L324.877 526.344L325.275 526.647L320.461 532.968L320.063 532.665L315.249 538.986L315.647 539.289L310.833 545.61L310.435 545.307L305.621 551.628L306.019 551.931L301.205 558.252L300.807 557.949L296.993 564.27L297.391 564.573L292.577 570.894L292.179 570.591L287.365 576.912L287.763 577.215L282.949 583.536L282.551 583.233L277.737 589.554L278.135 589.857L273.321 596.178L272.923 595.875L268.109 602.196L268.507 602.499L263.693 608.82L263.295 608.517L258.481 614.838L258.879 615.141L254.065 621.462L253.667 621.159L248.853 627.48L249.251 627.783L244.437 634.104L244.039 633.801L239.225 640.122L239.623 640.425L234.809 646.746L234.411 646.443L229.597 652.764L229.995 653.067L225.181 659.388L224.783 659.085L219.969 665.406L220.367 665.709L215.553 672.03L215.155 671.727L210.341 678.048L210.739 678.351L205.925 684.672L205.527 684.369"
              fill="url(#paint0_linear_1_667)"
            />
            <defs>
              <linearGradient
                id="paint0_linear_1_667"
                x1="306"
                y1="0"
                x2="306"
                y2="697"
                gradientUnits="userSpaceOnUse"
              >
                <stop stopColor="#2C3E50" />
                <stop offset="1" stopColor="#4CA1AF" />
              </linearGradient>
            </defs>
          </svg>
        </div>

        {/* Login Form */}
        <div className="w-full max-w-md rounded-lg bg-white p-8 shadow-lg z-10">
          <h2 className="mb-6 text-2xl font-bold text-gray-800 text-center">
            Officer Logins
          </h2>

          {message && (
            <div
              className={`mb-4 rounded p-2 text-center ${
                message.includes("success") ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800"
              }`}
            >
              {message}
            </div>
          )}

          <form onSubmit={handleLogin} className="space-y-4">
            <div>
              <label className="block text-gray-700 mb-1">Email</label>
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                className="w-full rounded border border-gray-300 px-3 py-2"
              />
            </div>

            <div>
              <label className="block text-gray-700 mb-1">Password</label>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                className="w-full rounded border border-gray-300 px-3 py-2"
              />
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full rounded bg-blue-600 text-white py-2 hover:bg-blue-700 transition"
            >
              {loading ? "Logging in..." : "Login"}
            </button>
          </form>

          <p className="mt-4 text-center text-gray-600">
            Don't have an account?{" "}
            <Link to="/signup" className="text-blue-600 hover:underline">
              Sign Up
            </Link>
          </p>
        </div>
      </div>
    </div>
  );
}

export default App;
